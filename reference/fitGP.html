<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fit a GP model — fitGP • GPEDM</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a GP model — fitGP"><meta property="og:description" content="Fits a GP model with separable length scales and automatic relevance determination (ARD).
Also fits a hierarchical version of the GP model if distinct populations are indicated
using pop.
There are several ways to specify the training data:
A. supply data frame data, plus column names or indices for y, x, pop, and time.
B. supply vectors for y, pop, and time, and a matrix or vector for x.
For each of the above 2 options, there are 3 options for specifying the predictors.
supplying y and x (omitting E and tau) will use the columns of x as predictors. This allows
for the most customization.
supplying y, E, and tau (omitting x) will use E lags of y (with spacing tau) as predictors.
This is equivalent to option 3 with x=y.
supplying y, x, E, and tau will use E lags of each column of x (with spacing tau) as predictors.
Do not use this option if x already contains lags, in that case use option 1.
Arguments pop and time are optional in all of the above cases.
If pop and time are supplied, they should NOT contain missing values.
This function will also, optionally, produce predictions.
See Details for more information."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GPEDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9007</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="https://github.com/tanyalrogers/GPEDM" class="external-link">Source Code</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit a GP model</h1>
    
    <div class="hidden name"><code>fitGP.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fits a GP model with separable length scales and automatic relevance determination (ARD).
Also fits a hierarchical version of the GP model if distinct populations are indicated
using <code>pop</code>.
There are several ways to specify the training data:</p><ul><li><p>A. supply data frame <code>data</code>, plus column names or indices for <code>y</code>, <code>x</code>, <code>pop</code>, and <code>time</code>.</p></li>
<li><p>B. supply vectors for <code>y</code>, <code>pop</code>, and <code>time</code>, and a matrix or vector for <code>x</code>.</p></li>
</ul><p>For each of the above 2 options, there are 3 options for specifying the predictors.</p><ol><li><p>supplying <code>y</code> and <code>x</code> (omitting <code>E</code> and <code>tau</code>) will use the columns of <code>x</code> as predictors. This allows
for the most customization.</p></li>
<li><p>supplying <code>y</code>, <code>E</code>, and <code>tau</code> (omitting <code>x</code>) will use <code>E</code> lags of <code>y</code> (with spacing <code>tau</code>) as predictors.
This is equivalent to option 3 with <code>x</code>=<code>y</code>.</p></li>
<li><p>supplying <code>y</code>, <code>x</code>, <code>E</code>, and <code>tau</code> will use <code>E</code> lags of <em>each column</em> of <code>x</code> (with spacing <code>tau</code>) as predictors.
Do not use this option if <code>x</code> already contains lags, in that case use option 1.</p></li>
</ol><p>Arguments <code>pop</code> and <code>time</code> are optional in all of the above cases.
If <code>pop</code> and <code>time</code> are supplied, they should NOT contain missing values.
This function will also, optionally, produce predictions.
See Details for more information.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fitGP</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pop <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  E <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tau <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scaling <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"global"</span>, <span class="st">"local"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  initpars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  modeprior <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  fixedpars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rhofixed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rhomatrix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  augdata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  predictmethod <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  newdata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  xnew <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  popnew <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  timenew <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ynew <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>A data frame, or matrix with named columns.</p></dd>


<dt>y</dt>
<dd><p>The response variable (required). If <code>data</code> is supplied, a column name
(character) of index (numeric). If <code>data</code> is not supplied, a numeric vector.</p></dd>


<dt>x</dt>
<dd><p>Predictor variables. If <code>data</code> is supplied, column names
(character vector) of indices (numeric vector). If <code>data</code> is not supplied, a numeric matrix
(or vector, if there is only one predictor variable). If <code>x</code> is not supplied,
values for <code>E</code> and <code>tau</code> must be provided to construct it internally.</p></dd>


<dt>pop</dt>
<dd><p>Identifies separate populations (optional, if not supplied, defaults to 1
population). Population values can be either numeric, character, or factor.
If <code>data</code> is supplied, a column name (character) of index (numeric).
If <code>data</code> is not supplied, a vector (numeric, character, or factor).</p></dd>


<dt>time</dt>
<dd><p>A time index (optional, if not supplied, defaults to a numeric index).
Important: The time index is not used for model fitting (timesteps are
assumed to be evenly spaced) but supplying <code>time</code> will be add these values to the output table,
which may be useful for later plotting purposes. If <code>data</code> is supplied, a column name
(character) of index (numeric). If <code>data</code> is not supplied, a numeric vector.</p></dd>


<dt>E</dt>
<dd><p>Embedding dimension. If supplied, will be used to constuct lags of <code>x</code> (or
lags of <code>y</code> if <code>x</code> is not supplied).</p></dd>


<dt>tau</dt>
<dd><p>Time delay. If supplied, will be used to constuct lags of <code>x</code> (or
lags of <code>y</code> if <code>x</code> is not supplied).</p></dd>


<dt>scaling</dt>
<dd><p>How the variables should be scaled (see Details). Scaling can be <code>"global"</code>
(default), <code>"local"</code> (only applicable if more than 1 pop), or <code>"none"</code>. Scaling is applied
to <code>y</code> and each <code>x</code>. For a mix of scalings, do it manually beforehand and
set scaling to <code>"none"</code>. All outputs are backtransformed to original scale.</p></dd>


<dt>initpars</dt>
<dd><p>Starting values for hyperparameters (see Details) in the order
<code>c(phi,ve,sigma2,rho)</code>, in constrained (non-transformed) space. Should be a numeric
vector with length <code>ncol(x)+3</code>. Defaults used if not supplied: <code>c(rep(0.1,ncol(x)), 0.001, 1-0.001, 0.5)</code></p></dd>


<dt>modeprior</dt>
<dd><p>This value is used by the phi prior and sets the expected number of modes over the unit interval.
Defaults to 1.</p></dd>


<dt>fixedpars</dt>
<dd><p>Fixes values of the hyperparameters phi, ve, and sigma2 (if desired). Should be a numeric
vector with length <code>ncol(x)+2</code> in the order <code>c(phi,ve,sigma2)</code> in constrained
(non-transformed) space. Hyperparameters to estimate should be input as NA. The value of rho is
fixed separately using argument <code>rhofixed</code>.</p></dd>


<dt>rhofixed</dt>
<dd><p>Fixes the rho parameter, if desired (see Details).</p></dd>


<dt>rhomatrix</dt>
<dd><p>Symmetrical square matrix of fixed pairwise rho values to use, with 1's on the diagonal.
The rows and columns should be named with the population identifier.
The output of <code><a href="getrhomatrix.html">getrhomatrix</a></code> can be used here.
All populations in the dataset must appear in <code>rhomatrix</code>. Populations in
<code>rhomatrix</code> that are not in the dataset are allowed and will not be used.</p></dd>


<dt>augdata</dt>
<dd><p>A data frame with augmentation data (see Details).</p></dd>


<dt>predictmethod</dt>
<dd><p>Using the training data, <code>loo</code> does leave-one-out prediction, <code>lto</code> does
leave-timepoint-out prediction, and <code>sequential</code> does sequential (leave-future-out)
prediction.</p></dd>


<dt>newdata</dt>
<dd><p>Data frame containing the same columns supplied in the
original model.</p></dd>


<dt>xnew</dt>
<dd><p>New predictor matrix or vector. Not required if <code>newdata</code> is supplied.</p></dd>


<dt>popnew</dt>
<dd><p>New population vector. Not required if <code>newdata</code> is supplied.</p></dd>


<dt>timenew</dt>
<dd><p>New time vector. Not required if <code>newdata</code> is supplied.</p></dd>


<dt>ynew</dt>
<dd><p>New response vector. Optional, unless <code>E</code> and <code>tau</code> were supplied in
lieu of <code>x</code>. Not required if <code>newdata</code> is supplied.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list (class GP and GPpred) with the following elements:</p>
<dl><dt>pars</dt>
<dd><p>Posterior mode of hyperparameters (named vector).</p></dd>

<dt>parst</dt>
<dd><p>Posterior mode of hyperparameters (named vector), transformed to real line (used for optimization).</p></dd>

<dt>grad</dt>
<dd><p>Likelihood gradients of hyperparameters at posterior mode. Can be used to assess convergence.</p></dd>

<dt>covm</dt>
<dd><p>List containing various covariance matrices and the inverse covariance matrix.</p></dd>

<dt>iter</dt>
<dd><p>Number of iterations until convergence was reached. Currently fixed at a max of 200.</p></dd>

<dt>inputs</dt>
<dd><p>Inputs and scaled inputs. Note that if you use <code>E</code> and <code>tau</code>,
the names of the predictors in the input data frame will be stored under
<code>x_names</code>, and the names of the lagged predictors corresponding to the
inverse length scales will be stored under <code>x_names2</code>, provided these names exist.</p></dd>

<dt>scaling</dt>
<dd><p>Scaling information.</p></dd>

<dt>insampresults</dt>
<dd><p>Data frame with in-sample predictions. <code>predfsd</code> is the standard
deviation of the GP function, <code>predsd</code> includes process error.</p></dd>

<dt>insampfitstats</dt>
<dd><p>Fit statistics for in-sample predictions. Includes R2, rmse, ln_post
(log posterior likelihood evaluated at the mode), lnL_LOO (generalized cross-validation approximate
leave-one-out negative log likelihood), and df (estimated degrees of freedom, equal to
the trace of the smoother matrix). lnL_LOO does not include the prior, so is not directly
comparable to ln_post. For diagnostics, also includes likelihood components ln_prior, SS, logdet.</p></dd>

<dt>insampfitstatspop</dt>
<dd><p>If &gt;1 population, fit statistics (R2 and rmse) for in-sample predictions by population.</p></dd>

<dt>outsampresults</dt>
<dd><p>Data frame with out-of-sample predictions (if requested). <code>predfsd</code> is the standard
deviation of the GP function, <code>predsd</code> includes process error.</p></dd>

<dt>outsampfitstats</dt>
<dd><p>Fit statistics for out-of-sample predictions (if requested).
Only computed if using <code>"loo"</code> or <code>"sequential"</code>, if <code>y</code> is found in <code>newdata</code>,
or if <code>ynew</code> supplied (i.e. if the observed values are known).</p></dd>

<dt>outsampfitstatspop</dt>
<dd><p>If &gt;1 population, fit statistics for out-of-sample predictions (if requested) by population.</p></dd>

<dt>call</dt>
<dd><p>Function call. Allows use of <code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></code>.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The data are assumed to be in time order. This is particularly important if <code>E</code> and <code>tau</code>
are supplied or <code>predictmethod="sequential"</code> is used.</p>
<p><strong>Missing values:</strong></p>
<p>Missing values for <code>y</code> and <code>x</code> are allowed. Any rows containing
missing values will be excluded from the model fitting procedure (reinserted
as NAs in the output). If <code>pop</code> and <code>time</code> are supplied, they
should NOT contain missing values.</p>
<p><strong>Hyperparameters:</strong></p>
<p>The model uses a squared exponential covariance function. See the (not yet written)
vignette for mathematical details.</p>
<p>There is one inverse length scale <code>phi</code> estimated for each predictor
variable (input dimension). Values near 0 indicate that the predictor has
little influence on the response variable, and it was likely dropped by ARD.
Higher values of <code>phi</code> indicate greater nonlinearity.</p>
<p>The estimated variance terms are <code>ve</code> (process variance) and
<code>sigma2</code> (pointwise prior variance).</p>
<p>Hyperparameter <code>rho</code> is the dynamic correlation in the hierarchical GP
model, indicating similarity of dynamics across populations. If there is only
1 population (e.g. if <code>pop</code> is not supplied), <code>rho</code> is irrelevant
(not used by the model) and will revert to the mode of its prior (~0.5). The
value of <code>rho</code> can be fixed to any value from 0.0001 to 0.9999 using
<code>rhofixed</code>, otherwise it is estimated from the data. Alternatively, a matrix
of fixed pairwise rho values can be supplied using <code>rhomatrix</code>. In this case,
the single rho parameter will also not be used and will revert to the mode of the
prior (~0.5). A pairwise rho matrix can be generated using <code><a href="getrhomatrix.html">getrhomatrix</a></code>,
or you can create a custom one (e.g. based on geographical distance).</p>
<p><strong>Scaling:</strong></p>
<p>The model priors assume the response variable and all predictor variables
have approximately zero mean and unit variance, therefore it is important to
scale the data properly when fitting these models. For convenience, this
function will scale the input data automatically by default, and
backtransform output to the original scale. Automatic scaling can be
<code>"global"</code> (default), or <code>"local"</code>. The latter will scale variables
within (as opposed to across) populations, so is obviously only applicable if
there is more than 1 population. You can also scale the data yourself
beforehand in whatever manner you wish and set <code>scaling="none"</code>. In this
case, you will obviously have to do the backtransformation yourself.</p>
<p><strong>Predictions:</strong></p>
<p>There are several options for producing predictions:</p><ol><li><p>Use <code>predictmethod="loo"</code> for leave-one-out prediction using the training data.</p></li>
<li><p>Use <code>predictmethod="lto"</code> for leave-timepoint-out prediction using the training data. This will leave
out values with the same time index across multiple populations, rather than each individual datapoint.
If there is only one population, <code>"lto"</code> will be equivalent to <code>"loo"</code>.</p></li>
<li><p>Use <code>predictmethod="sequential"</code> for sequential (leave-future-out) prediction using the training data.</p></li>
<li><p>If data frame <code>data</code> was supplied, supply data frame <code>newdata</code> containing same column names.
Column for <code>y</code> is optional, unless <code>E</code> and <code>tau</code> were supplied in lieu of <code>x</code>.</p></li>
<li><p>If vectors/matrices were supplied for <code>y</code>, <code>x</code>, etc, equivalent vector/matrices <code>xnew</code>,
<code>popnew</code> (if <code>pop</code> was supplied), and <code>timenew</code> (optional).
<code>ynew</code> is optional, unless <code>E</code> and <code>tau</code> were supplied in lieu of <code>x</code>.</p></li>
</ol><p>After fitting, predictions can also be made using <code><a href="predict.GP.html">predict.GP</a></code>.
Predictions can plotted using <code><a href="plot.GPpred.html">plot.GPpred</a></code>.
Get conditional responses using <code><a href="getconditionals.html">getconditionals</a></code>.</p>
<p>It should be noted that <code>"loo"</code> is not a "true" leave-one-out, for although each prediction is
made by removing one of the training points, the hyperparameters are fit using all of the training data.
The same goes for <code>"sequential"</code>.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Munch, S. B., Poynor, V., and Arriaza, J. L. 2017. Circumventing structural uncertainty:
a Bayesian perspective on nonlinear forecasting for ecology. Ecological Complexity, 32: 134.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="predict.GP.html">predict.GP</a></code>, <code><a href="plot.GPpred.html">plot.GPpred</a></code>, <code><a href="getconditionals.html">getconditionals</a></code>, <code><a href="getrhomatrix.html">getrhomatrix</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">yrand</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">testgp</span><span class="op">=</span><span class="fu">fitGP</span><span class="op">(</span>y<span class="op">=</span><span class="va">yrand</span>,E<span class="op">=</span><span class="fl">2</span>,tau<span class="op">=</span><span class="fl">1</span>,predictmethod <span class="op">=</span> <span class="st">"loo"</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Stephan Munch, Tanya Rogers.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

