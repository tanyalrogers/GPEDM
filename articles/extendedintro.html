<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extended Introduction to GPEDM ‚Ä¢ GPEDM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Extended Introduction to GPEDM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GPEDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9010</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="https://github.com/tanyalrogers/GPEDM" class="external-link">Source Code</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Extended Introduction to GPEDM</h1>
            
      

      <div class="hidden name"><code>extendedintro.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tanyalrogers.github.io/GPEDM">GPEDM</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="mathematical-foundation">Mathematical foundation<a class="anchor" aria-label="anchor" href="#mathematical-foundation"></a>
</h2>
<p>The GP model fit by <code>GPEDM</code> is as described in Munch et
al.¬†(2017). This model uses a mean function of 0 and a squared
exponential covariance function with one inverse length scale
hyperparameter
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œï</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\phi_i</annotation></semantics></math>)
for each input
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
(predictor). The values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œï</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\phi_i</annotation></semantics></math>
tell you about the wiggliness of the function with respect to each
input: a value of 0 indicates no relationship (the function is flat),
low values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œï</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\phi_i</annotation></semantics></math>
indicate a mostly linear relationship (the function is very stiff), and
large values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œï</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\phi_i</annotation></semantics></math>
indicate more nonlinear relationships (the function is more wiggly). The
model, which is Bayesian, is as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>y</mi><mi>t</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>f</mi><mo>,</mo><msub><mi>ùê±</mi><mi>t</mi></msub><mo>,</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">]</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>‚àº</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ùê±</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>V</mi><mi>œµ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>f</mi><mo stretchy="false" form="prefix">|</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">]</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>‚àº</mo><mi>G</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>Œ£</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">]</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
p[y_{t}|f,\mathbf{x}_{t},\theta]&amp;\sim N(f(\mathbf{x}_t),V_\epsilon) \\
p[f|\theta]&amp;\sim GP(0,\Sigma) \\
p[\theta]
\end{aligned}
</annotation></semantics></math> Where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ∏</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
is the collection of hyperparameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>œï</mi><mn>1</mn></msub><mi>.</mi><mi>.</mi><mi>.</mi><msub><mi>œï</mi><mi>E</mi></msub><mo>,</mo><msub><mi>V</mi><mi>œµ</mi></msub><mo>,</mo><msup><mi>œÉ</mi><mn>2</mn></msup><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{\phi_1...\phi_E, V_\epsilon, \sigma^2\}</annotation></semantics></math>,
and the covariance function is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ£</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ùê±</mi><mi>t</mi></msub><mo>,</mo><msub><mi>ùê±</mi><mi>s</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>œÉ</mi><mn>2</mn></msup><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mo>‚àí</mo><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>E</mi></munderover><msub><mi>œï</mi><mi>i</mi></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub><mo>‚àí</mo><msub><mi>x</mi><mrow><mi>i</mi><mi>s</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mrow><annotation encoding="application/x-tex"> \Sigma(\mathbf{x}_t,\mathbf{x}_s)=\sigma^2 {\exp[-\sum_{i=1}^{E}\phi_i(x_{it}-x_{is})^2]} </annotation></semantics></math></p>
<p>The package finds the optimal values of the hyperparameters (each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œï</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\phi_i</annotation></semantics></math>,
process variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mi>œµ</mi></msub><annotation encoding="application/x-tex">V_\epsilon</annotation></semantics></math>,
pointwise prior variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>œÉ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math>)
numerically using a likelihood gradient descent algorithm (Rprop), which
finds the posterior mode. The priors on the inverse length scales are
set up for automatic relevance determination (ARD): The priors have a
mode at 0, meaning that if a predictor does not have a strong influence,
its
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œï</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\phi_i</annotation></semantics></math>
will go to 0 (effectively dropping it from the model). The priors also
have mean such that the function on average has one local maximum or
minimum with respect to that predictor, which imposes a wiggliness
penalty on the estimated function. The priors for the variance terms are
weakly informative.</p>
<p>Because of the assumed mean function of 0 and the length scale
priors, all the data (both the response variable and all predictor
variables) need to be centered on 0 and scaled to a standard deviation
of 1. Because this is standardization is always required, the
<code>GPEDM</code> functions will conveniently standardize all the
supplied data internally, and then backtransform all the outputs back to
their original units, so you don‚Äôt have to worry about this too
much.</p>
<p>Since the GP requires an inversion of the covariance matrix at every
iteration of the fitting algorithm, it does not scale well (complexity
scales as order
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>n</mi><mn>3</mn></msup><annotation encoding="application/x-tex">n^3</annotation></semantics></math>),
and it becomes increasingly slow as the number of data points increases.
It will become noticeably slow with more than several hundred
datapoints, and extremely slow with more than 1000. Improving this is on
Steve‚Äôs to-do list.</p>
</div>
<div class="section level2">
<h2 id="model-structures">Model structures<a class="anchor" aria-label="anchor" href="#model-structures"></a>
</h2>
<p>There are basically two ways to specify a model structure.</p>
<p><strong>E/tau Method:</strong> Supply a time series
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
and values for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÑ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>.
The model fitting function will construct lags internally
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
lags of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
with spacing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÑ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>)
and use those as predictors. This method is convenient, but has some
limitations. First, it assumes a fixed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÑ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>,
so you can‚Äôt use unevenly spaced lags. Second, there are limited ways in
which covariates can be incorporated.</p>
<p><strong>Custom Lags Method:</strong> Construct the lags yourself
externally, and supply the exact response variable and the exact
collection of predictor variables to use. The model fitting function
will use those directly. This allows for the most flexibility and
customization, in that you can use any response variable and any
collection of lag predictors from any number of variables.</p>
<p>The timesteps (each row in your data table) have to be <em>evenly
spaced</em> and <em>in chronological order</em>, otherwise the automatic
lag construction will not work properly.</p>
<p>The model fitting function is <code>fitGP</code>. The data are
supplied to these functions under <code>data</code>. Here‚Äôs a table of
the most important parameters.</p>
<table class="table">
<colgroup>
<col width="17%">
<col width="23%">
<col width="58%">
</colgroup>
<thead><tr class="header">
<th>Parameter</th>
<th>Description</th>
<th>Notes</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>data</code></td>
<td>Data frame containing the <em>training</em> data</td>
<td>Columns can be in any order.</td>
</tr>
<tr class="even">
<td><code>y</code></td>
<td>Name of the response variable</td>
<td>Character or numeric column index.</td>
</tr>
<tr class="odd">
<td><code>x</code></td>
<td>Name(s) of the predictor variables</td>
<td>Character vector or numeric vector of column indices.</td>
</tr>
<tr class="even">
<td><code>E</code></td>
<td>Embedding dimension (number of lags)</td>
<td>Positive integer.</td>
</tr>
<tr class="odd">
<td><code>tau</code></td>
<td>Time delay</td>
<td>Positive integer. No default.</td>
</tr>
<tr class="even">
<td><code>time</code></td>
<td>Name of the time column</td>
<td>Optional, but recommended. If omitted, defaults to a numeric
index.</td>
</tr>
<tr class="odd">
<td><code>pop</code></td>
<td>Name of population ID column</td>
<td>Required if your dataset contains time series from multiple
populations. Could represent other types of replicate time series, not
just populations.</td>
</tr>
<tr class="even">
<td><code>scaling</code></td>
<td>Data standardization</td>
<td>Data are centered and scaled by default as required by the model.
Automatic scaling can be done across populations (<code>"global"</code>,
the default) or within populations (<code>"local"</code>). Equivalent if
only one population. You can also scale the data yourself beforehand in
any manner you wish and set <code>scaling="none"</code>.</td>
</tr>
</tbody>
</table>
<p>If <code>E</code> and <code>tau</code> are supplied, the model uses
the E/tau Method. If using the E/tau Method and multiple variables are
listed under <code>x</code>, <code>fitGP</code> uses
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
lags with spacing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÑ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
of <em>each</em> variable. If <code>E</code> and <code>tau</code> are
omitted, the function will use the Custom Lags Method, using all the
variables in <code>x</code> as predictors.</p>
<p>The response variable (target <code>y</code>) in <code>fitGP</code>
is always ‚Äòstationary‚Äô, in that the columns of <code>x</code> predict
the value of <code>y</code> in the same row, not in any other rows,
similar to other regression functions in R (equivalent to
<code>Tp=0</code> in the package <code>rEDM</code>). The effective
forecast horizon defaults to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÑ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
when using the E/tau Method, producing the model:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>œÑ</mi></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mn>2</mn><mi>œÑ</mi></mrow></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>E</mi><mi>œÑ</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_{t}=f(y_{t-\tau},y_{t-2\tau},...,y_{t-E\tau})</annotation></semantics></math></p>
<p>Variation in the forecast horizon (independently of <code>tau</code>)
can be attained using the Custom Lags Method and shifting the lags
appropriately. You would want a model of the following form, which
reverts to the form above when <code>h</code>=<code>tau</code>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>+</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>œÑ</mi><mo>+</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>E</mi><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>œÑ</mi><mo>+</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_{t}=f(y_{t-(0+h)},y_{t-(\tau+h)},...,y_{t-((E-1)\tau+h)})</annotation></semantics></math></p>
<p>The following table gives the model structure that results when
different combinations of inputs are supplied.</p>
<table class="table">
<colgroup>
<col width="4%">
<col width="21%">
<col width="11%">
<col width="62%">
</colgroup>
<thead><tr class="header">
<th><code>y</code></th>
<th><code>x</code></th>
<th>
<code>E</code>, <code>tau</code>
</th>
<th>resulting model</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>y</td>
<td>omitted or y</td>
<td>supplied</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>œÑ</mi></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mn>2</mn><mi>œÑ</mi></mrow></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>E</mi><mi>œÑ</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_{t}=f(y_{t-\tau},y_{t-2\tau},...,y_{t-E\tau})</annotation></semantics></math></td>
</tr>
<tr class="even">
<td>y</td>
<td>x</td>
<td>supplied</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>œÑ</mi></mrow></msub><mo>,</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>‚àí</mo><mn>2</mn><mi>œÑ</mi></mrow></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>E</mi><mi>œÑ</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_{t}=f(x_{t-\tau},x_{t-2\tau},...,x_{t-E\tau})</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td>y</td>
<td>y, x</td>
<td>supplied</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>œÑ</mi></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mn>2</mn><mi>œÑ</mi></mrow></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>E</mi><mi>œÑ</mi></mrow></msub><mo>,</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>œÑ</mi></mrow></msub><mo>,</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>‚àí</mo><mn>2</mn><mi>œÑ</mi></mrow></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>E</mi><mi>œÑ</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_{t}=f(y_{t-\tau},y_{t-2\tau},...,y_{t-E\tau}, x_{t-\tau},x_{t-2\tau},...,x_{t-E\tau})</annotation></semantics></math></td>
</tr>
<tr class="even">
<td>y</td>
<td>x, z</td>
<td>supplied</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>œÑ</mi></mrow></msub><mo>,</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>‚àí</mo><mn>2</mn><mi>œÑ</mi></mrow></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>E</mi><mi>œÑ</mi></mrow></msub><mo>,</mo><msub><mi>z</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>œÑ</mi></mrow></msub><mo>,</mo><msub><mi>z</mi><mrow><mi>t</mi><mo>‚àí</mo><mn>2</mn><mi>œÑ</mi></mrow></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>z</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>E</mi><mi>œÑ</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_{t}=f(x_{t-\tau},x_{t-2\tau},...,x_{t-E\tau}, z_{t-\tau},z_{t-2\tau},...,z_{t-E\tau})</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td>y</td>
<td>x, z</td>
<td>omitted</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo>,</mo><msub><mi>z</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_{t}=f(x_{t},z_{t})</annotation></semantics></math></td>
</tr>
<tr class="even">
<td>y</td>
<td>x(t-1), z(t-1)</td>
<td>omitted</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>z</mi><mrow><mi>t</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_{t}=f(x_{t-1},z_{t-1})</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td>y</td>
<td>y(t-a), y(t-b), x(t-c)</td>
<td>omitted</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>a</mi></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>b</mi></mrow></msub><mo>,</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>c</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_{t}=f(y_{t-a}, y_{t-b}, x_{t-c})</annotation></semantics></math></td>
</tr>
<tr class="even">
<td>y</td>
<td>y or y, x</td>
<td>omitted</td>
<td>Invalid models
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_{t}=f(y_{t})</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mo>,</mo><msub><mi>x</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_{t}=f(y_{t}, x_t)</annotation></semantics></math>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="cross-validation-and-prediction">Cross validation and prediction<a class="anchor" aria-label="anchor" href="#cross-validation-and-prediction"></a>
</h2>
<p>Predicting with the GP has two stages (for a given <code>E</code> and
<code>tau</code> or set of predictors). First, you have to optimize
(fit) the hyperparameters (inverse length scales, variances) given the
training data. This is the slow part. Then, you can make predictions for
some test data given the hyperparameters and the training data. This
part is much faster. Because of this, the model fitting and model
prediction steps are broken up into two different functions. The
function <code>fitGP</code> does the model fitting. The
<code>predict</code> function is used to make predictions from a fitted
model. The function <code>fitGP</code> will (optionally) invoke
<code>predict</code> once internally and make one set of predictions if
you supply it with the inputs for <code>predict</code>. The function
<code>predict</code>, on its own, can be used as many times as you want
for as many test datasets as you want without having to retrain the
model. To arbitrarily change the training data without refitting the
hyperparameters, you can run <code>fitGP</code> with the hyperparameters
fixed, which will skip optimization (see argument
<code>fixedpars</code>, which also allow for a mixture of fixed and
estimated hyperparameters).</p>
<p>The training data are supplied under <code>data</code> in
<code>fitGP</code>. Test data are supplied (in a separate data frame)
under <code>newdata</code> in either <code>predict</code> or
<code>fitGP</code>. The column names used in the model need to appear in
both <code>data</code> and <code>newdata</code>. This is similar to
making predictions from other models in R.</p>
<p>To get predicted values using leave-one-out cross-validation, set
<code>predictmethod = "loo"</code> in either <code>predict</code> or
<code>fitGP</code>. This will conduct leave-one-out over all of the
training data. There are also a couple other <code>predictmethod</code>
options built in. The option <code>lto</code> (leave-timepoint-out) is
the same as leave-one-out except that is leaves out all points from a
given time (only relevant if there are multiple populations). For both
<code>"loo"</code> and <code>"lto"</code>, an exclusion radius (Theiler
window) can be set using <code>exclradius</code> (defaults to 0). The
option <code>sequential</code> makes a prediction for each time point in
the training data, leaving out all future time points. Note that in all
of these methods, training data are iteratively omitted for the
predictions, but the hyperparameter values used are those obtained using
all of the training data (the model is not refit).</p>
<p>The function <code>predict_seq</code> also generates predictions for
a data frame <code>newdata</code>, but sequentially adds each new
observation to the training data and refits the model. This simulates a
real-time forecasting application. This prediction method is similar to
<code>predictmethod="sequential"</code> (leave-future-out), but in this
case, the future time points are not included in the training data used
to obtain the hyperparameters. It is also similar to the train/test
split using newdata, but in this case, the training data and model
hyperparameters are sequentially updated with each timestep. This method
is definitely slower than just fitting the hyperparameters once, but can
be worth doing to avoid annoying reviewer comments.</p>
<p>For iterated multistep predictions, check out the function
<code>predict_iter</code>.</p>
</div>
<div class="section level2">
<h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>Our example dataset will be the chaotic 3-species Hastings-Powell
model. There are simulated data from this model included in the
<code>GPEDM</code> package. We will add a bit of observation noise to
the data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">HastPow3sp</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Time         X         Y        Z</span></span>
<span><span class="co">#&gt; 1    0 0.8000000 0.1000000 9.000000</span></span>
<span><span class="co">#&gt; 2    1 0.8293102 0.1036896 8.986057</span></span>
<span><span class="co">#&gt; 3    2 0.8399347 0.1090985 8.974955</span></span>
<span><span class="co">#&gt; 4    3 0.8398126 0.1159568 8.967575</span></span>
<span><span class="co">#&gt; 5    4 0.8332662 0.1242236 8.964660</span></span>
<span><span class="co">#&gt; 6    5 0.8223340 0.1339824 8.966918</span></span>
<span><span class="va">n</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">HastPow3sp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">HastPow3sp</span><span class="op">$</span><span class="va">X</span><span class="op">=</span><span class="va">HastPow3sp</span><span class="op">$</span><span class="va">X</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>,<span class="fl">0</span>,<span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">HastPow3sp</span><span class="op">$</span><span class="va">Y</span><span class="op">=</span><span class="va">HastPow3sp</span><span class="op">$</span><span class="va">Y</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>,<span class="fl">0</span>,<span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">HastPow3sp</span><span class="op">$</span><span class="va">Z</span><span class="op">=</span><span class="va">HastPow3sp</span><span class="op">$</span><span class="va">Z</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>,<span class="fl">0</span>,<span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">X</span><span class="op">~</span><span class="va">Time</span>, data <span class="op">=</span> <span class="va">HastPow3sp</span>, type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">Time</span>, data <span class="op">=</span> <span class="va">HastPow3sp</span>, type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Z</span><span class="op">~</span><span class="va">Time</span>, data <span class="op">=</span> <span class="va">HastPow3sp</span>, type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span></code></pre></div>
<p><img src="extendedintro_files/figure-html/dataplot-1.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="creating-lags">Creating lags<a class="anchor" aria-label="anchor" href="#creating-lags"></a>
</h2>
<p>The <code>GPEDM</code> function for making lags is
<code>makelags</code>, which makes lags
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>œÑ</mi></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mn>2</mn><mi>œÑ</mi></mrow></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>‚àí</mo><mi>E</mi><mi>œÑ</mi></mrow></msub></mrow><annotation encoding="application/x-tex">y_{t-\tau},y_{t-2\tau},...,y_{t-E\tau}</annotation></semantics></math>.
The lag is indicated after the underscore. If <code>append=T</code>, it
will return <code>data</code> with the lags appended, otherwise just the
lags.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gpedmlags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makelags.html">makelags</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">HastPow3sp</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>,<span class="st">"Y"</span><span class="op">)</span>, E <span class="op">=</span> <span class="fl">2</span>, tau <span class="op">=</span> <span class="fl">1</span>, append <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gpedmlags</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Time         X          Y        Z       X_1       X_2        Y_1        Y_2</span></span>
<span><span class="co">#&gt; 1    0 0.7686773 0.08515657 8.956461        NA        NA         NA         NA</span></span>
<span><span class="co">#&gt; 2    1 0.8384924 0.04452754 8.996594 0.7686773        NA 0.08515657         NA</span></span>
<span><span class="co">#&gt; 3    2 0.7981533 0.10966309 8.978425 0.8384924 0.7686773 0.04452754 0.08515657</span></span>
<span><span class="co">#&gt; 4    3 0.9195766 0.16553683 8.884442 0.7981533 0.8384924 0.10966309 0.04452754</span></span>
<span><span class="co">#&gt; 5    4 0.8497416 0.20392200 9.005202 0.9195766 0.7981533 0.16553683 0.10966309</span></span>
<span><span class="co">#&gt; 6    5 0.7813106 0.06534688 8.871301 0.8497416 0.9195766 0.20392200 0.16553683</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-for-a-single-time-series">Model for a single time series<a class="anchor" aria-label="anchor" href="#model-for-a-single-time-series"></a>
</h2>
<p>In this example, we split the original dataset (without lags) into a
training and testing set, and fit a model with some arbitrary embedding
parameters using the E/tau Method. For expediency we will put the test
data in <code>fitGP</code> as well to generate predictions with one
function call. You could omit it though.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#E/tau Method with training/test split</span></span>
<span><span class="va">HPtrain</span> <span class="op">&lt;-</span> <span class="va">HastPow3sp</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span>,<span class="op">]</span></span>
<span><span class="va">HPtest</span> <span class="op">&lt;-</span> <span class="va">HastPow3sp</span><span class="op">[</span><span class="fl">201</span><span class="op">:</span><span class="fl">300</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">gp_out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitGP.html">fitGP</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">HPtrain</span>, time <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>                 y <span class="op">=</span> <span class="st">"X"</span>, E <span class="op">=</span> <span class="fl">3</span>, tau <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                 newdata <span class="op">=</span> <span class="va">HPtest</span><span class="op">)</span></span></code></pre></div>
<p>The <code>summary</code> function quickly gives you the fitted values
of the inverse length scales <code>phi</code> for each predictor, the
variance terms, the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
value for the training data (<code>In-sample R-squared</code>), and the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
value for the test data (<code>Out-of-sample R-squared</code>) if test
data were provided. A crude plot of the observed and predicted values
can be obtained using <code>plot</code>. By default, <code>plot</code>
will plot the out-of-sample predictions (for the test data, or the
leave-one-out predictions if requested) if available.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gp_out1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of predictors: 3 </span></span>
<span><span class="co">#&gt; Length scale parameters:</span></span>
<span><span class="co">#&gt;      predictor posteriormode</span></span>
<span><span class="co">#&gt; phi1       X_2       0.12878</span></span>
<span><span class="co">#&gt; phi2       X_4       0.00832</span></span>
<span><span class="co">#&gt; phi3       X_6       0.06941</span></span>
<span><span class="co">#&gt; Process variance (ve): 0.1422683</span></span>
<span><span class="co">#&gt; Pointwise prior variance (sigma2): 2.648974</span></span>
<span><span class="co">#&gt; Number of populations: 1</span></span>
<span><span class="co">#&gt; In-sample R-squared: 0.8702953 </span></span>
<span><span class="co">#&gt; Out-of-sample R-squared: 0.7764384</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gp_out1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Plotting out of sample results.</span></span></code></pre></div>
<p><img src="extendedintro_files/figure-html/gpplot-1.png" width="672"></p>
<p>The output of <code>fitGP</code> is a rather involved list object
containing everything needed to make prediction from the model (much of
which is for bookkeeping), but there are a few important outputs you may
want to look at and extract. See <code><a href="../reference/fitGP.html">help(fitGP)</a></code> for more
detail about the outputs.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#the values of the hyperparameters</span></span>
<span><span class="va">gp_out1</span><span class="op">$</span><span class="va">pars</span></span>
<span><span class="co">#&gt;       phi1       phi2       phi3         ve     sigma2        rho </span></span>
<span><span class="co">#&gt; 0.12878249 0.00832415 0.06941378 0.14226828 2.64897436 0.50000000</span></span>
<span></span>
<span><span class="co">#fits to the training data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gp_out1</span><span class="op">$</span><span class="va">insampresults</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;    timestep pop  predmean     predfsd     predsd       obs</span></span>
<span><span class="co">#&gt; 1         0   1        NA          NA         NA 0.7686773</span></span>
<span><span class="co">#&gt; 2         1   1        NA          NA         NA 0.8384924</span></span>
<span><span class="co">#&gt; 3         2   1        NA          NA         NA 0.7981533</span></span>
<span><span class="co">#&gt; 4         3   1        NA          NA         NA 0.9195766</span></span>
<span><span class="co">#&gt; 5         4   1        NA          NA         NA 0.8497416</span></span>
<span><span class="co">#&gt; 6         5   1        NA          NA         NA 0.7813106</span></span>
<span><span class="co">#&gt; 7         6   1 0.8386267 0.010150692 0.06686471 0.8321681</span></span>
<span><span class="co">#&gt; 8         7   1 0.8032712 0.013345600 0.06742372 0.8266759</span></span>
<span><span class="co">#&gt; 9         8   1 0.8403718 0.009173628 0.06672338 0.7967478</span></span>
<span><span class="co">#&gt; 10        9   1 0.8270748 0.014528528 0.06766780 0.7266621</span></span>
<span></span>
<span><span class="co">#fit stats for the training data</span></span>
<span><span class="co"># also contains the posterior log likelihood (ln_post) </span></span>
<span><span class="co"># and the approximate degrees of freedom (df)</span></span>
<span><span class="va">gp_out1</span><span class="op">$</span><span class="va">insampfitstats</span></span>
<span><span class="co">#&gt;            R2          rmse       ln_post      ln_prior       lnL_LOO </span></span>
<span><span class="co">#&gt;    0.87029532    0.06378033   66.93817771   -6.37130896   87.94567945 </span></span>
<span><span class="co">#&gt;            df            SS        logdet </span></span>
<span><span class="co">#&gt;   11.37727102  192.31273268 -169.46585301</span></span>
<span></span>
<span><span class="co">#fits to the test data (if provided)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gp_out1</span><span class="op">$</span><span class="va">outsampresults</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;    timestep pop  predmean    predfsd     predsd       obs</span></span>
<span><span class="co">#&gt; 1       200   1        NA         NA         NA 0.9900145</span></span>
<span><span class="co">#&gt; 2       201   1        NA         NA         NA 1.0517643</span></span>
<span><span class="co">#&gt; 3       202   1        NA         NA         NA 1.0439760</span></span>
<span><span class="co">#&gt; 4       203   1        NA         NA         NA 0.9448869</span></span>
<span><span class="co">#&gt; 5       204   1        NA         NA         NA 0.8433004</span></span>
<span><span class="co">#&gt; 6       205   1        NA         NA         NA 1.0777695</span></span>
<span><span class="co">#&gt; 7       206   1 0.8751934 0.02073712 0.06926674 0.9805625</span></span>
<span><span class="co">#&gt; 8       207   1 0.9854028 0.03513164 0.07484708 0.9673377</span></span>
<span><span class="co">#&gt; 9       208   1 0.9713476 0.02407234 0.07033727 0.9310551</span></span>
<span><span class="co">#&gt; 10      209   1 0.9685994 0.01669068 0.06816474 0.9466032</span></span>
<span></span>
<span><span class="co">#fit stats for the test data</span></span>
<span><span class="va">gp_out1</span><span class="op">$</span><span class="va">outsampfitstats</span></span>
<span><span class="co">#&gt;         R2       rmse </span></span>
<span><span class="co">#&gt; 0.77643843 0.09321996</span></span></code></pre></div>
<p>If you wanted to make predictions for another test dataset, say the
next 100 values, you can use <code>predict</code> rather than refit the
model. The function <code>plot</code> will work on this output as well.
The function <code>summary</code> will not, but you can access the fit
statistics and predictions directly.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HPtest2</span> <span class="op">&lt;-</span> <span class="va">HastPow3sp</span><span class="op">[</span><span class="fl">301</span><span class="op">:</span><span class="fl">400</span>,<span class="op">]</span></span>
<span><span class="va">pred1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">gp_out1</span>, newdata <span class="op">=</span> <span class="va">HPtest2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Plotting out of sample results.</span></span></code></pre></div>
<p><img src="extendedintro_files/figure-html/predict-1.png" width="672"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred1</span><span class="op">$</span><span class="va">outsampfitstats</span></span>
<span><span class="co">#&gt;         R2       rmse </span></span>
<span><span class="co">#&gt; 0.88362895 0.09065743</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred1</span><span class="op">$</span><span class="va">outsampresults</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;    timestep pop  predmean    predfsd     predsd       obs</span></span>
<span><span class="co">#&gt; 1       300   1        NA         NA         NA 0.8972228</span></span>
<span><span class="co">#&gt; 2       301   1        NA         NA         NA 0.8124524</span></span>
<span><span class="co">#&gt; 3       302   1        NA         NA         NA 0.9750660</span></span>
<span><span class="co">#&gt; 4       303   1        NA         NA         NA 0.8683485</span></span>
<span><span class="co">#&gt; 5       304   1        NA         NA         NA 0.9805712</span></span>
<span><span class="co">#&gt; 6       305   1        NA         NA         NA 0.9830768</span></span>
<span><span class="co">#&gt; 7       306   1 0.9543466 0.01123664 0.06703817 0.9204649</span></span>
<span><span class="co">#&gt; 8       307   1 0.9096497 0.01767054 0.06841127 0.9527711</span></span>
<span><span class="co">#&gt; 9       308   1 0.9427910 0.01038420 0.06690056 0.8805288</span></span>
<span><span class="co">#&gt; 10      309   1 0.9398071 0.01266367 0.06729207 0.9545281</span></span></code></pre></div>
<p>Note that the first <code>E*tau</code> values are missing, which will
happen when using the E/tau Method, since data prior to the start of the
test dataset are unknown. This can be prevented using the Custom Lags
Method. This approach also allows you to change the forecast horizon by
changing the lags used. For instance, if you wanted to use a forecast
horizon of 3 with a <code>tau</code> of 2, you would change the lags to
3, 5, and 7.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Custom Lags Method with training/test split</span></span>
<span><span class="va">HastPow3sp_lags</span><span class="op">=</span><span class="fu"><a href="../reference/makelags.html">makelags</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">HastPow3sp</span>, y <span class="op">=</span> <span class="st">"X"</span>, E <span class="op">=</span> <span class="fl">3</span>, tau <span class="op">=</span> <span class="fl">2</span>, append <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">HastPow3sp_lags</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Time" "X"    "Y"    "Z"    "X_2"  "X_4"  "X_6"</span></span>
<span></span>
<span><span class="va">HPtrain_lags</span> <span class="op">&lt;-</span> <span class="va">HastPow3sp_lags</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span>,<span class="op">]</span></span>
<span><span class="va">HPtest_lags</span> <span class="op">&lt;-</span> <span class="va">HastPow3sp_lags</span><span class="op">[</span><span class="fl">201</span><span class="op">:</span><span class="fl">300</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">gp_out2a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitGP.html">fitGP</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">HPtrain_lags</span>, time <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>                 y <span class="op">=</span> <span class="st">"X"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X_2"</span>, <span class="st">"X_4"</span>, <span class="st">"X_6"</span><span class="op">)</span>,</span>
<span>                 newdata <span class="op">=</span> <span class="va">HPtest_lags</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gp_out2a</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of predictors: 3 </span></span>
<span><span class="co">#&gt; Length scale parameters:</span></span>
<span><span class="co">#&gt;      predictor posteriormode</span></span>
<span><span class="co">#&gt; phi1       X_2       0.12878</span></span>
<span><span class="co">#&gt; phi2       X_4       0.00832</span></span>
<span><span class="co">#&gt; phi3       X_6       0.06941</span></span>
<span><span class="co">#&gt; Process variance (ve): 0.1422683</span></span>
<span><span class="co">#&gt; Pointwise prior variance (sigma2): 2.648974</span></span>
<span><span class="co">#&gt; Number of populations: 1</span></span>
<span><span class="co">#&gt; In-sample R-squared: 0.8702953 </span></span>
<span><span class="co">#&gt; Out-of-sample R-squared: 0.8018431</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gp_out2a</span><span class="op">$</span><span class="va">outsampresults</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;    timestep pop  predmean     predfsd     predsd       obs</span></span>
<span><span class="co">#&gt; 1       200   1 0.9660618 0.015604646 0.06790698 0.9900145</span></span>
<span><span class="co">#&gt; 2       201   1 0.9490278 0.008292018 0.06660789 1.0517643</span></span>
<span><span class="co">#&gt; 3       202   1 0.9794000 0.018911390 0.06874223 1.0439760</span></span>
<span><span class="co">#&gt; 4       203   1 0.9630971 0.019025391 0.06877368 0.9448869</span></span>
<span><span class="co">#&gt; 5       204   1 0.9828270 0.019624579 0.06894184 0.8433004</span></span>
<span><span class="co">#&gt; 6       205   1 0.9599322 0.014307521 0.06762070 1.0777695</span></span>
<span><span class="co">#&gt; 7       206   1 0.8751934 0.020737125 0.06926674 0.9805625</span></span>
<span><span class="co">#&gt; 8       207   1 0.9854028 0.035131635 0.07484708 0.9673377</span></span>
<span><span class="co">#&gt; 9       208   1 0.9713476 0.024072342 0.07033727 0.9310551</span></span>
<span><span class="co">#&gt; 10      209   1 0.9685994 0.016690676 0.06816474 0.9466032</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gp_out2a</span><span class="op">)</span></span>
<span><span class="co">#&gt; Plotting out of sample results.</span></span></code></pre></div>
<p><img src="extendedintro_files/figure-html/gp2a-1.png" width="672"></p>
<p>To use leave-one-out on whatever dataset is in <code>data</code>, set
<code>predictmethod = "loo"</code>, and set <code>exclradius</code> if
necessary. The predictions will also be under
<code>outsampresults</code>. Note that predicting using leave-one-out is
slower than predicting for <code>newdata</code> because each prediction
requires a matrix inversion (because the training data change with the
removal of each point). Predicting with <code>newdata</code> requires no
matrix inversions and is very quick.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Custom Lags Method with leave one out</span></span>
<span><span class="va">HastPow3sp_lags</span><span class="op">=</span><span class="fu"><a href="../reference/makelags.html">makelags</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">HastPow3sp</span>, y <span class="op">=</span> <span class="st">"X"</span>, E <span class="op">=</span> <span class="fl">3</span>, tau <span class="op">=</span> <span class="fl">2</span>, append <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">HastPow3sp_lags</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Time" "X"    "Y"    "Z"    "X_2"  "X_4"  "X_6"</span></span>
<span></span>
<span><span class="va">HPtrain_lags_sub</span> <span class="op">&lt;-</span> <span class="va">HastPow3sp_lags</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">300</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">gp_out2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitGP.html">fitGP</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">HPtrain_lags_sub</span>, time <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>                 y <span class="op">=</span> <span class="st">"X"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X_2"</span>, <span class="st">"X_4"</span>, <span class="st">"X_6"</span><span class="op">)</span>,</span>
<span>                 predictmethod <span class="op">=</span> <span class="st">"loo"</span>, exclradius <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gp_out2b</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of predictors: 3 </span></span>
<span><span class="co">#&gt; Length scale parameters:</span></span>
<span><span class="co">#&gt;      predictor posteriormode</span></span>
<span><span class="co">#&gt; phi1       X_2       0.15505</span></span>
<span><span class="co">#&gt; phi2       X_4       0.00657</span></span>
<span><span class="co">#&gt; phi3       X_6       0.11070</span></span>
<span><span class="co">#&gt; Process variance (ve): 0.1456399</span></span>
<span><span class="co">#&gt; Pointwise prior variance (sigma2): 2.335599</span></span>
<span><span class="co">#&gt; Number of populations: 1</span></span>
<span><span class="co">#&gt; In-sample R-squared: 0.8640155 </span></span>
<span><span class="co">#&gt; Out-of-sample R-squared: 0.8472371</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gp_out2b</span><span class="op">)</span></span>
<span><span class="co">#&gt; Plotting out of sample results.</span></span></code></pre></div>
<p><img src="extendedintro_files/figure-html/gp2b-1.png" width="672"></p>
<p>Running <code>predict</code> on an already fitted model with
<code>predictmethod = "loo"</code> (or another
<code>predictmethod</code>) will perform it on the training data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loopreds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">gp_out1</span>, predictmethod <span class="op">=</span> <span class="st">"loo"</span>, exclradius <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="multivariate-models">Multivariate models<a class="anchor" aria-label="anchor" href="#multivariate-models"></a>
</h2>
<p>Multiple predictor variables (and their lags) can be used in either
<code>fitGP</code> by listing them under <code>x</code>. If you are
using the same number of lags and the same <code>tau</code> for each
variable, you can use the E/tau Method. If you want to mix and match
predictors, you can use the Custom Lags Method and pick any combination.
Since <code>fitGP</code> standardizes each input internally, and there
are separate length scales for each input, data standardization is not
as important as it is for other methods like Simplex and S-map. The
following two models are equivalent.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#E/tau Method with leave one out, multivariate</span></span>
<span><span class="va">gp_out_mv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitGP.html">fitGP</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">HPtrain</span>, time <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>                   y <span class="op">=</span> <span class="st">"X"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span>, <span class="st">"Z"</span><span class="op">)</span>,</span>
<span>                   E <span class="op">=</span> <span class="fl">1</span>, tau <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                   predictmethod <span class="op">=</span> <span class="st">"loo"</span>, exclradius <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gp_out_mv</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of predictors: 3 </span></span>
<span><span class="co">#&gt; Length scale parameters:</span></span>
<span><span class="co">#&gt;      predictor posteriormode</span></span>
<span><span class="co">#&gt; phi1       X_2       0.12043</span></span>
<span><span class="co">#&gt; phi2       Y_2       0.01721</span></span>
<span><span class="co">#&gt; phi3       Z_2       0.01313</span></span>
<span><span class="co">#&gt; Process variance (ve): 0.1464649</span></span>
<span><span class="co">#&gt; Pointwise prior variance (sigma2): 2.49394</span></span>
<span><span class="co">#&gt; Number of populations: 1</span></span>
<span><span class="co">#&gt; In-sample R-squared: 0.8635693 </span></span>
<span><span class="co">#&gt; Out-of-sample R-squared: 0.8340371</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Custom Lags Method with with leave one out, multivariate</span></span>
<span><span class="va">HastPow3sp_lags_mv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makelags.html">makelags</a></span><span class="op">(</span><span class="va">HastPow3sp</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span>, <span class="st">"Z"</span><span class="op">)</span>, </span>
<span>                               E <span class="op">=</span> <span class="fl">1</span>, tau <span class="op">=</span> <span class="fl">2</span>, append <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">HastPow3sp_lags_mv</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Time" "X"    "Y"    "Z"    "X_2"  "Y_2"  "Z_2"</span></span>
<span></span>
<span><span class="va">HPtrain_lags_mv_train</span> <span class="op">&lt;-</span> <span class="va">HastPow3sp_lags_mv</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">gp_out_mv2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitGP.html">fitGP</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">HPtrain_lags_mv_train</span>, time <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>                    y <span class="op">=</span> <span class="st">"X"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X_2"</span>, <span class="st">"Y_2"</span>, <span class="st">"Z_2"</span><span class="op">)</span>,</span>
<span>                    predictmethod <span class="op">=</span> <span class="st">"loo"</span>, exclradius <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="hierarchical-models-time-series-from-multiple-populations">Hierarchical models (time series from multiple populations)<a class="anchor" aria-label="anchor" href="#hierarchical-models-time-series-from-multiple-populations"></a>
</h2>
<p>The <code>GPEDM</code> package also allows for hierarchical model
structures: time series (including multivariate time series) from
multiple populations can be used that share similar (but not necessarily
identical) dynamics. I‚Äôll be referring to these replicate time series as
‚Äòpopulations‚Äô because a typical case in ecology is for the time series
to come from multiple populations in space (which is why the input is
called <code>pop</code>), but know that the ‚Äòpopulations‚Äô could be other
things, like age classes, or different experimental replicates. For
population
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
the model is as follows</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>y</mi><mrow><mi>j</mi><mi>t</mi></mrow></msub><mo stretchy="false" form="prefix">|</mo><mi>f</mi><mo>,</mo><msub><mi>ùê±</mi><mi>t</mi></msub><mo>,</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">]</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>‚àº</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>f</mi><mi>j</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ùê±</mi><mrow><mi>j</mi><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>V</mi><mi>œµ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>f</mi><mi>j</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">]</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>‚àº</mo><mi>G</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œº</mi><mo>,</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msub><mi>œÅ</mi><mi>D</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>Œ£</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Œº</mi><mo stretchy="false" form="prefix">|</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">]</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>‚àº</mo><mi>G</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msub><mi>œÅ</mi><mi>D</mi></msub><mi>Œ£</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
p[y_{jt}|f,\mathbf{x}_{t},\theta]&amp;\sim N(f_j(\mathbf{x}_{jt}),V_\epsilon) \\
p[f_j|\theta]&amp;\sim GP(\mu,(1-\rho_D)\Sigma) \\
p[\mu|\theta]&amp;\sim GP(0,\rho_D\Sigma) \\
p(\theta)
\end{aligned}
</annotation></semantics></math></p>
<p>Here, the covariance function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ£</mi><annotation encoding="application/x-tex">\Sigma</annotation></semantics></math>
is partitioned into within-population and across-population components,
are related by the dynamic correlation hyperparameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œÅ</mi><mi>D</mi></msub><annotation encoding="application/x-tex">\rho_D</annotation></semantics></math>.
The value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œÅ</mi><mi>D</mi></msub><annotation encoding="application/x-tex">\rho_D</annotation></semantics></math>,
which is between 0 and 1, tells us how similar the dynamics are across
populations. The dynamics are identical when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œÅ</mi><mi>D</mi></msub><annotation encoding="application/x-tex">\rho_D</annotation></semantics></math>
approaches 1 and independent when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œÅ</mi><mi>D</mi></msub><annotation encoding="application/x-tex">\rho_D</annotation></semantics></math>
approaches 0. In contrast to traditional correlation metrics
(e.g.¬†Pearson cross-correlation), which quantify the similarity of
population fluctuations over time (i.e.¬†synchrony), the dynamic
correlation quantifies the similarity of population responses across
predictor space. The value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œÅ</mi><mi>D</mi></msub><annotation encoding="application/x-tex">\rho_D</annotation></semantics></math>
(in the code, <code>rho</code>) can be estimated (with a uniform prior
and gradient descent) or fixed.</p>
<p>The <code>fitGP</code> and <code>makelags</code> are designed to
accept data from multiple populations and create lags without
‚Äòcrossover‚Äô between different time series. To do this, the data should
be in long format, with a column (numeric or character) to indicate
different populations (e.g.¬†site ID). The name of the indicator column
is supplied under <code>pop</code>.</p>
<p>As an example, here are some simulated data from 2 populations
(<code>PopA</code> and <code>PopB</code>) with theta logistic dynamics.
The data contain some small lognormal process noise, and the populations
have different theta values.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">thetalog2pop</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Time Population  Abundance</span></span>
<span><span class="co">#&gt; 1    1       PopA 1.56206299</span></span>
<span><span class="co">#&gt; 2    2       PopA 0.01692529</span></span>
<span><span class="co">#&gt; 3    3       PopA 0.05832723</span></span>
<span><span class="co">#&gt; 4    4       PopA 0.18778535</span></span>
<span><span class="co">#&gt; 5    5       PopA 0.64571264</span></span>
<span><span class="co">#&gt; 6    6       PopA 1.51896549</span></span>
<span><span class="va">pA</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">thetalog2pop</span>,<span class="va">Population</span><span class="op">==</span><span class="st">"PopA"</span><span class="op">)</span></span>
<span><span class="va">pB</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">thetalog2pop</span>,<span class="va">Population</span><span class="op">==</span><span class="st">"PopB"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Abundance</span><span class="op">~</span><span class="va">Time</span>,data<span class="op">=</span><span class="va">pA</span>,type<span class="op">=</span><span class="st">"l"</span>,main<span class="op">=</span><span class="st">"PopA"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Abundance</span><span class="op">~</span><span class="va">Time</span>,data<span class="op">=</span><span class="va">pB</span>,type<span class="op">=</span><span class="st">"l"</span>,main<span class="op">=</span><span class="st">"PopB"</span><span class="op">)</span></span></code></pre></div>
<p><img src="extendedintro_files/figure-html/data-1.png" width="672"></p>
<p>When dealing with multiple populations, you have to think a little
more carefully about whether you want to scale data across populations
(<code>scaling = "global"</code>) or within populations
(<code>scaling = "local"</code>). Since the data are on somewhat
different scales and don‚Äôt necessarily represent the same ‚Äòunits‚Äô, we
will use local scaling, as opposed to global. For a more detailed
discussion of this, see the next lesson.</p>
<p>The model setup for a hierarchical model is the same as other models,
you just need to add a <code>pop</code> column to indicate there are
multiple populations. I am not including an exclusion radius for
leave-one-out in this case, because the data are not autocorrelated.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#E/tau method and leave-one-out, multiple populations</span></span>
<span><span class="va">tlogtest</span><span class="op">=</span><span class="fu"><a href="../reference/fitGP.html">fitGP</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">thetalog2pop</span>, time <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>               y <span class="op">=</span> <span class="st">"Abundance"</span>, pop <span class="op">=</span> <span class="st">"Population"</span>, </span>
<span>               E <span class="op">=</span> <span class="fl">3</span>, tau <span class="op">=</span> <span class="fl">1</span>, scaling <span class="op">=</span> <span class="st">"local"</span>, </span>
<span>               predictmethod <span class="op">=</span> <span class="st">"loo"</span>, exclradius <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">tlogtest</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of predictors: 3 </span></span>
<span><span class="co">#&gt; Length scale parameters:</span></span>
<span><span class="co">#&gt;        predictor posteriormode</span></span>
<span><span class="co">#&gt; phi1 Abundance_1        0.5317</span></span>
<span><span class="co">#&gt; phi2 Abundance_2        0.0000</span></span>
<span><span class="co">#&gt; phi3 Abundance_3        0.0000</span></span>
<span><span class="co">#&gt; Process variance (ve): 0.01222333</span></span>
<span><span class="co">#&gt; Pointwise prior variance (sigma2): 2.527349</span></span>
<span><span class="co">#&gt; Number of populations: 2</span></span>
<span><span class="co">#&gt; Dynamic correlation (rho): 0.327254</span></span>
<span><span class="co">#&gt; In-sample R-squared: 0.9933975 </span></span>
<span><span class="co">#&gt; In-sample R-squared by population:</span></span>
<span><span class="co">#&gt;             R2</span></span>
<span><span class="co">#&gt; PopA 0.9970811</span></span>
<span><span class="co">#&gt; PopB 0.9815187</span></span>
<span><span class="co">#&gt; Out-of-sample R-squared: 0.991238</span></span>
<span><span class="co">#&gt; Out-of-sample R-squared by population:</span></span>
<span><span class="co">#&gt;             R2</span></span>
<span><span class="co">#&gt; PopA 0.9961280</span></span>
<span><span class="co">#&gt; PopB 0.9754702</span></span></code></pre></div>
<p>From the summary, we can see that ARD has (perhaps unsurprisingly)
deemed lags 2 and 3 to be unimportant (<code>phi</code> values are 0),
so <code>E = 1</code> is probably sufficient. The fitted dynamic
correlation (<code>rho = 0.32</code>) tells us that the dynamics are
rather dissimilar. The within population and across population
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
values are also displayed (these are normalized by either the within or
across population variance).</p>
<p>Here‚Äôs a plot.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tlogtest</span><span class="op">)</span></span>
<span><span class="co">#&gt; Plotting out of sample results.</span></span></code></pre></div>
<p><img src="extendedintro_files/figure-html/hierplot-1.png" width="700"></p>
<p>For more information on fitting hierarchical models, including the
use of pairwise dynamic correlations with &gt;2 populations, see <a href="https://tanyalrogers.github.io/GPEDM/articles/hierarchical.html">this
vignette</a>.</p>
</div>
<div class="section level2">
<h2 id="visualizing-f-conditional-responses">Visualizing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>
(conditional responses)<a class="anchor" aria-label="anchor" href="#visualizing-f-conditional-responses"></a>
</h2>
<p>One thing you might be wondering is how we can visualize the shape of
our fitted function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>.
If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>
is 1- or 2-dimensional, we can create a grid of input values, pass them
as <code>newdata</code>, and plot the resulting line or surface. If the
function is more than 2 dimensional, this gets tricky, but we can look
at slices of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>
with respect to certain predictors, holding the values of the other
predictors constant. The function <code>getconditionals</code> is a
wrapper that will compute and plot conditional responses to each input
variable with all other input variables set to their mean value.
Although it does not show interactions, it can be useful for visualizing
the effects of the predictors. Can also be used to check that your
function isn‚Äôt doing something nonsensical and inconsistent with
biology. To create 2-d conditionals surfaces, or to look at conditional
responses with other predictors fixed to values other than their mean,
you can pass an appropriately constructed grid to <code>newdata</code>.
Visualizing models this way makes it possible to think about EDM from a
more ‚Äòmechanistic‚Äô functional viewpoint.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#From the multivariate Hastings-Powell simulation</span></span>
<span><span class="fu"><a href="../reference/getconditionals.html">getconditionals</a></span><span class="op">(</span><span class="va">gp_out_mv</span><span class="op">)</span></span></code></pre></div>
<p><img src="extendedintro_files/figure-html/conditionals1-1.png" width="672"></p>
<p>Here are the conditional responses for the 2 population theta
logistic simulation. Recall that the <code>phi</code> values for lags 2
and 3 were 0, so the corresponding relationship is flat.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#From the 2 population theta logistic</span></span>
<span><span class="fu"><a href="../reference/getconditionals.html">getconditionals</a></span><span class="op">(</span><span class="va">tlogtest</span><span class="op">)</span></span></code></pre></div>
<p><img src="extendedintro_files/figure-html/conditionals2-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="local-slope-coefficients-from-the-gp">Local slope coefficients from the GP<a class="anchor" aria-label="anchor" href="#local-slope-coefficients-from-the-gp"></a>
</h2>
<p>Just as with S-map, it is possible to obtain local slope coefficients
from a GP model. The partial derivatives of the fitted GP function at
each time point with respect to each input can be obtained from the
<code>predict</code> function, setting <code>returnGPgrad = T</code>.
They will be under <code>model$GPgrad</code>. The gradient will be
computed for each out-of-sample prediction point requested (using
methods <code>"loo"</code>, <code>"lto"</code>, or
<code>newdata</code>). If you want the in-sample gradient, pass the
original (training) data back in as <code>newdata</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#From the multivariate Hastings-Powell simulation</span></span>
<span><span class="va">grad1</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">gp_out_mv2</span>, predictmethod <span class="op">=</span> <span class="st">"loo"</span>, exclradius <span class="op">=</span> <span class="fl">6</span>, returnGPgrad <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">grad1</span><span class="op">$</span><span class="va">GPgrad</span><span class="op">)</span></span>
<span><span class="co">#&gt;       d_X_2      d_Y_2      d_Z_2</span></span>
<span><span class="co">#&gt; 1        NA         NA         NA</span></span>
<span><span class="co">#&gt; 2        NA         NA         NA</span></span>
<span><span class="co">#&gt; 3 0.8778238 -0.5689806 0.03631435</span></span>
<span><span class="co">#&gt; 4 0.8618503 -0.4125486 0.02126581</span></span>
<span><span class="co">#&gt; 5 0.9504046 -0.5375552 0.03520486</span></span>
<span><span class="co">#&gt; 6 0.9334179 -0.4231009 0.02623887</span></span>
<span></span>
<span><span class="va">gradplot</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">HPtrain_lags_mv_train</span>, <span class="va">grad1</span><span class="op">$</span><span class="va">GPgrad</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d_X_2</span><span class="op">~</span><span class="va">Time</span>, data<span class="op">=</span><span class="va">gradplot</span>, type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d_Y_2</span><span class="op">~</span><span class="va">Time</span>, data<span class="op">=</span><span class="va">gradplot</span>, type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d_Z_2</span><span class="op">~</span><span class="va">Time</span>, data<span class="op">=</span><span class="va">gradplot</span>, type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span></code></pre></div>
<p><img src="extendedintro_files/figure-html/gpgrad-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="other-things-to-know">Other things to know<a class="anchor" aria-label="anchor" href="#other-things-to-know"></a>
</h2>
<p>You can, alternatively, pass the training/test data to the functions
as vectors and matrices rather than in a data frame. This may make more
sense if you‚Äôre doing simulations and just have a bunch of vectors and
matrices, rather than importing data in a data frame.</p>
<p>The <code>makelags</code> function has some other bells and whistles
you might want to check out, like creating matrix for forecasting beyond
the end of a time series, and creating lags suitable for the variable
step size method (more about that <a href="https://tanyalrogers.github.io/GPEDM/articles/vtimestep.html">here</a>).</p>
<p>There are a few additional, optional arguments to <code>fitGP</code>.
<code>initpars</code> are the starting values of the hyperparameters, if
for some reason you want to change those. <code>modeprior</code> is a
value used in the <code>phi</code> prior that controls the expected
number of modes the resulting function has over the unit interval
(defaults to 1). Larger values for <code>modeprior</code> make the prior
less informative. The only reason to change this would be to test
whether the prior is having any influence on the results.
<code>linprior</code> fits the model to the residuals of a linear
relationship between <code>y</code> and the first variable of
<code>x</code>. More information about this can be found in the <a href="https://tanyalrogers.github.io/GPEDM/articles/fisheries.html">fisheries
vignette</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Stephan Munch, Tanya Rogers.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
