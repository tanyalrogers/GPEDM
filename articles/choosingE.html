<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Choosing Embedding Parameters • GPEDM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Choosing Embedding Parameters">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GPEDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9010</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="https://github.com/tanyalrogers/GPEDM" class="external-link">Source Code</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Choosing Embedding Parameters</h1>
            
      

      <div class="hidden name"><code>choosingE.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tanyalrogers.github.io/GPEDM">GPEDM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>One of the most common questions we get is how to choose the
embedding dimension
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
and time delay
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
for a given time series. There is, unfortunately, no one correct way to
do this. We detail below some general guidelines and different
approaches that can be used to select these values.</p>
<p>The <em>maximum</em> embedding dimension that can be estimated for a
time series of length
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
is approximately
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msqrt><mi>T</mi></msqrt><annotation encoding="application/x-tex">\sqrt{T}</annotation></semantics></math>
(Cheng and Tong 1992), so the largest
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
considered should not exceed this too greatly. The actual attractor
dimension of the system may be higher, but the dimension you’re going to
be able to resolve will be limited by time series length. You also may
have valid reasons to limit the largest
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
considered to something less than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msqrt><mi>T</mi></msqrt><annotation encoding="application/x-tex">\sqrt{T}</annotation></semantics></math>.
Note that in multivariate models (e.g. those with covariates)
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
is the total number of predictors including lags, covariates, and lags
of covariates. The total number of predictors should not exceed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msqrt><mi>T</mi></msqrt><annotation encoding="application/x-tex">\sqrt{T}</annotation></semantics></math>,
meaning you may need to use fewer lags if you add covariates to the
model. For example,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>,</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>3</mn></mrow></msub><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{x_{t-1},x_{t-2},x_{t-3}\}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{x_{t-1},x_{t-2},y_{t-1}\}</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>z</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{x_{t-1},y_{t-1},z_{t-1}\}</annotation></semantics></math>
are all 3-dimensional embeddings
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">E=3</annotation></semantics></math>).</p>
<p>In terms of selecting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>,
fixing it to 1 can be a completely justifiable approach, particularly if
your sampling interval is coarse relative to the dynamics of the system.
However, if the sampling interval is fine, or the timescale of dynamics
uncertain, you might wish to explore other values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>.
The generation time of the species under study (if longer than the
sampling interval) can sometimes provide a good ballpark estimate for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>.
The first zero crossing of the autocorrelation function is another
method proposed for identifying
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>,
although this is most suitable for continuous time systems, and may not
work as well for discrete time systems.</p>
<p>If you have multiple series, then the maximum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
can be based on the total number of time points across all series,
provided that the product
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>τ</mi></mrow><annotation encoding="application/x-tex">E\tau</annotation></semantics></math>
is less than the length of the shortest individual time series. For
example, if you have 100 replicate series that are each only 5 time
points long, you may have 500 data points, but you can’t use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
more than 5 (or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>τ</mi><mo>&gt;</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">E\tau&gt;5</annotation></semantics></math>)
because for no point do you know
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mn>6</mn></mrow></msub><annotation encoding="application/x-tex">y_{t-6}</annotation></semantics></math>,
and you will end up with zero usable delay vectors.</p>
<p>Also keep in mind that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>τ</mi></mrow><annotation encoding="application/x-tex">E\tau</annotation></semantics></math>
data points will always be lost from the beginning of the time series
(or each time series), as well as after every missing data point (if you
are keeping them in and skipping them). In the absence of a long,
continuous time series, you might want to set some threshold for the
amount of data lost when constructing lags, so that you end up with a
sufficient number of valid delay vectors. For instance, when evaluating
possible
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
values for S-map EDM, Rogers et al. (2022) required both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>≤</mo><msqrt><mi>T</mi></msqrt></mrow><annotation encoding="application/x-tex">E\leq \sqrt{T}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>τ</mi><mo>≤</mo><mn>0.2</mn><mi>T</mi></mrow><annotation encoding="application/x-tex">E\tau\leq 0.2T</annotation></semantics></math>
(i.e. you cannot remove more than 20% of the data points). So, larger
values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
could be tested when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
was small.</p>
<p>Once you have identified a space of reasonable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
combinations to consider, there are a variety of methods you can use to
select them (either independently or jointly). The false nearest
neighbors approach is one method for identifying
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
that can be successful, but since it requires defining a threshold at
which point neighbors are or are not considered ‘false’, it can be
difficult to apply consistently across various time series. The
Grassberger-Procacia algorithm is another, but it tends to be sensitive
to noise and sample size. Both also assume a fixed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>.
More commonly,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
are selected jointly using some metric of out-of-sample model
performance and a grid search. Note that because
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
are discrete quantities, there is no ‘gradient’ that can be derived to
find a best value using likelihood based optimizers; they have to be
found by trial and error.</p>
<p>GP-EDM includes automatic relevance determination (ARD), which
enables some additional strategies for choosing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
beyond the grid search. ARD involves placing priors on the inverse
length scale parameters with a mode of 0 (akin to a wiggliness penalty)
that effectively eliminates uninformative lags, so can be used (in
theory) to automatically identify
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
and choose the relevant time lags
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
values).</p>
<p>We present a few possible methods below, which are based on model
performance. Note that performance must be evaluated
<em>out-of-sample</em>, e.g. using leave-one-out cross validation, a
training/test split, or some other method (which method to use will
depend on how much data you have). In-sample performance will always
increase as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
increases, but out-of-sample performance will cease to improve
substantially once the optimal
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
is reached.</p>
<p>Because real data are rarely as cooperative as models, we present
both a model example (noise-free, 3 species Hastings-Powell model) and a
real data example (shortfin squid mean catch-per-unit-effort from a
bottom trawl survey in the Gulf of Maine) for each method.</p>
</div>
<div class="section level2">
<h2 id="grid-search-method">1. Grid search method<a class="anchor" aria-label="anchor" href="#grid-search-method"></a>
</h2>
<p>Evaluate all possible models and select the best performing. This is
the most computationally intensive, but also the most thorough, and the
only option if the hyperparameters that cannot be optimized numerically.
For instance, Rogers et al. (2022) found that the best approach in S-map
EDM was to evaluate all possible combinations of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>,
and the S-map local weighting parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
and choose the one with the highest out-of-sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>.
(It is worth pointing out that if you do a giant search like this with
‘out-of-sample’
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>,
you probably want to also do an ‘out-of-out-of-sample’ evaluation of the
end product, if sufficient data exist. For example, have a training,
test, <em>and</em> validation dataset.)</p>
<p>Performance may or may not reach a maximum as you increase
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>;
it may simply plateau, where beyond a certain
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>,
models are effectively equivalent and there is no ‘appreciable’ gain in
performance. In this case, you will probably want to choose the simplest
(lowest
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>)
model of the plateau, rather than model at the actual maximum, if that
maximum performance differs little from the performance of the simpler
model. This could be made more rigorous by including a penalty for the
degrees of freedom in the performance metric.</p>
<p>When evaluating a large number of possible models, you can run into
identifiability issues, in that multiple models can have identical or
near identical fits. For example, a periodic time series with a period
of 4 can be perfectly described with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>/<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
combinations of 2/1, 4/1, 2/2, 1/4, 1/8, etc. It can be useful to
establish criteria for determining which models are effectively
equivalent (e.g. they differ by less than 0.01 in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>),
and how equivalent models should be ranked (e.g. prioritize simpler,
more linear models). For example, Rogers et al. (2022) selected the one
with the lowest
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
(in that order). This is particularly problematic in simulated data with
little to no noise, where many different models can have high fit
statistics, but can happen with real data as well, where there is not a
clear ‘winner’ among the candidate models.</p>
<p>Since the inverse length scales in GP-EDM are optimized using
gradient descent, this leaves just the values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
that need to be determined. However, running an entire grid search with
GP-EDM is probably unnecessary because of ARD, and you could instead use
one of the other methods.</p>
<div class="section level4">
<h4 id="hastings-powell-model">Hastings Powell model<a class="anchor" aria-label="anchor" href="#hastings-powell-model"></a>
</h4>
<p>Since we have plenty of simulated data, we’ll split the time series
into a training and testing set, each of 200 points. To ensure that the
out-of-sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
is evaluated over the same test set regardless of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
(the first
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>τ</mi></mrow><annotation encoding="application/x-tex">E\tau</annotation></semantics></math>
points of the test dataset are not eliminated), we generate the lags
beforehand (see the last example in <a href="https://tanyalrogers.github.io/GPEDM/index.html#other-types-of-predictions">this
section</a> of the readme). With 200 points, we could consider
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
up to 14, but since we know that is far higher than necessary for this
model system, we’ll set max
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
to 8 to save some time.</p>
<p>We find that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">E=2</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\tau=1</annotation></semantics></math>
are sufficient here. This is a continuous time model with an integration
step size of 1, so it is also not surprising that higher
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
values work well as long as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
is at least 2.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#we'll just consider the X variable</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html" class="external-link">qplot</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">X</span>, x<span class="op">=</span><span class="va">Time</span>, data<span class="op">=</span><span class="va">HastPow3sp</span>, geom <span class="op">=</span> <span class="st">"line"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `qplot()` was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; This warning is displayed once every 8 hours.</span></span>
<span><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span>
<span><span class="co">#&gt; generated.</span></span></code></pre></div>
<p><img src="choosingE_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#create grid of E and tau to consider</span></span>
<span><span class="va">Emax</span><span class="op">=</span><span class="fl">8</span></span>
<span><span class="va">taumax</span><span class="op">=</span><span class="fl">3</span></span>
<span><span class="va">Etaugrid</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>E<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">Emax</span>,tau<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">taumax</span><span class="op">)</span></span>
<span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">R2</span><span class="op">=</span><span class="cn">NA</span></span>
<span></span>
<span><span class="co">#generate all lags</span></span>
<span><span class="va">HPlags</span><span class="op">=</span><span class="fu"><a href="../reference/makelags.html">makelags</a></span><span class="op">(</span><span class="va">HastPow3sp</span>,<span class="st">"X"</span>,E<span class="op">=</span><span class="va">Emax</span><span class="op">*</span><span class="va">taumax</span>, tau<span class="op">=</span><span class="fl">1</span>, append<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#split training and test</span></span>
<span><span class="va">HP_train</span><span class="op">=</span><span class="va">HPlags</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span>,<span class="op">]</span></span>
<span><span class="va">HP_test</span><span class="op">=</span><span class="va">HPlags</span><span class="op">[</span><span class="fl">201</span><span class="op">:</span><span class="fl">400</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#loop through the grid</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Etaugrid</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">#fit model with ith combo of E and tau</span></span>
<span>  <span class="va">demo</span><span class="op">=</span><span class="fu"><a href="../reference/fitGP.html">fitGP</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">HP_train</span>, </span>
<span>             y<span class="op">=</span><span class="st">"X"</span>,</span>
<span>             x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"X_"</span>,<span class="va">Etaugrid</span><span class="op">$</span><span class="va">tau</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">E</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, </span>
<span>             time<span class="op">=</span><span class="st">"Time"</span>, </span>
<span>             newdata <span class="op">=</span> <span class="va">HP_test</span><span class="op">)</span></span>
<span>  <span class="co">#store out of sample R2</span></span>
<span>  <span class="va">Etaugrid</span><span class="op">$</span><span class="va">R2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">=</span><span class="va">demo</span><span class="op">$</span><span class="va">outsampfitstats</span><span class="op">[</span><span class="st">"R2"</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">Etaugrid</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">E</span>, y<span class="op">=</span><span class="va">tau</span>, fill<span class="op">=</span><span class="va">R2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">taumax</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">Emax</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"gray"</span><span class="op">)</span>, </span>
<span>        panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"black"</span>, fill<span class="op">=</span><span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="choosingE_files/figure-html/unnamed-chunk-2-2.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">R2round</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">R2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#if not aleady in order</span></span>
<span><span class="co">#Etaugrid=Etaugrid[order(Etaugrid$tau,Etaugrid$E),] </span></span>
<span><span class="op">(</span><span class="va">bestE</span><span class="op">=</span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">E</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">R2round</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="op">(</span><span class="va">besttau</span><span class="op">=</span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">tau</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">R2round</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="va">demo</span><span class="op">=</span><span class="fu"><a href="../reference/fitGP.html">fitGP</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">HP_train</span>, y<span class="op">=</span><span class="st">"X"</span>,</span>
<span>           x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"X_"</span>,<span class="va">besttau</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">bestE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           time<span class="op">=</span><span class="st">"Time"</span>, newdata <span class="op">=</span> <span class="va">HP_test</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">demo</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of predictors: 2 </span></span>
<span><span class="co">#&gt; Length scale parameters:</span></span>
<span><span class="co">#&gt;      predictor posteriormode</span></span>
<span><span class="co">#&gt; phi1       X_1       0.21716</span></span>
<span><span class="co">#&gt; phi2       X_2       0.33140</span></span>
<span><span class="co">#&gt; Process variance (ve): 0.0001761443</span></span>
<span><span class="co">#&gt; Pointwise prior variance (sigma2): 4.365049</span></span>
<span><span class="co">#&gt; Number of populations: 1</span></span>
<span><span class="co">#&gt; In-sample R-squared: 0.9998473 </span></span>
<span><span class="co">#&gt; Out-of-sample R-squared: 0.9979118</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">demo</span><span class="op">)</span></span>
<span><span class="co">#&gt; Plotting out of sample results.</span></span></code></pre></div>
<p><img src="choosingE_files/figure-html/unnamed-chunk-2-3.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="squid-data">Squid data<a class="anchor" aria-label="anchor" href="#squid-data"></a>
</h4>
<p>This is 44 year annual time series, thus the max
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
should be about 6 or 7. The squid species being sampled has an annual
life history, so <code>tau=1</code> would make the most biological
sense. Just for demonstration purposes, we set the max
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
to 3. To provide a more complex example in which the predictor and
response variables are different, we will model growth rate as a
function of log abundance (we will need to generate the lags beforehand,
option 1 in <a href="https://tanyalrogers.github.io/GPEDM/index.html#specifying-training-data">Specifying
training data</a>). Because the time series is relatively short, we will
use leave-one-out to evaluate performance.</p>
<p>We find that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\tau=1</annotation></semantics></math>
is clearly the best, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">E=6</annotation></semantics></math>
produces the best performance, although only minorly over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">E=4</annotation></semantics></math>
(they differ in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
by only 0.0102). You would be justified in selecting either
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">E=4</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">E=6</annotation></semantics></math>,
perhaps going for the smaller one if you were interested in
parsimony.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#we'll just consider one population for this example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">trawl</span><span class="op">)</span></span>
<span><span class="va">squid</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">trawl</span>,<span class="va">REGION</span><span class="op">==</span><span class="st">"GME"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html" class="external-link">qplot</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">shortfin_squid</span>, x<span class="op">=</span><span class="va">YEAR</span>, data<span class="op">=</span><span class="va">squid</span>, geom <span class="op">=</span> <span class="st">"line"</span><span class="op">)</span></span></code></pre></div>
<p><img src="choosingE_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#growth rate and log abundance</span></span>
<span><span class="va">squid</span><span class="op">$</span><span class="va">squidlog</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">squid</span><span class="op">$</span><span class="va">shortfin_squid</span><span class="op">)</span></span>
<span><span class="va">squid</span><span class="op">$</span><span class="va">squidgr</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">squid</span><span class="op">$</span><span class="va">squidlog</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#time series length</span></span>
<span><span class="va">serlen</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">squid</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#create grid of E and tau to consider</span></span>
<span><span class="va">Emax</span><span class="op">=</span><span class="fl">6</span></span>
<span><span class="va">taumax</span><span class="op">=</span><span class="fl">3</span></span>
<span><span class="va">Etaugrid</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>E<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">Emax</span>,tau<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">taumax</span><span class="op">)</span></span>
<span><span class="co">#remove E and tau combinations that lose too much data (other critera could be used)</span></span>
<span><span class="va">Etaugrid</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Etaugrid</span>, <span class="va">Etaugrid</span><span class="op">$</span><span class="va">E</span><span class="op">^</span><span class="fl">2</span><span class="op">&lt;=</span><span class="va">serlen</span> <span class="op">&amp;</span> <span class="va">Etaugrid</span><span class="op">$</span><span class="va">E</span><span class="op">*</span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">tau</span><span class="op">/</span><span class="va">serlen</span><span class="op">&lt;=</span><span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">R2</span><span class="op">=</span><span class="cn">NA</span></span>
<span></span>
<span><span class="co">#generate all lags</span></span>
<span><span class="va">squidlags</span><span class="op">=</span><span class="fu"><a href="../reference/makelags.html">makelags</a></span><span class="op">(</span><span class="va">squid</span>,<span class="st">"squidlog"</span>,E<span class="op">=</span><span class="va">Emax</span><span class="op">*</span><span class="va">taumax</span>, tau<span class="op">=</span><span class="fl">1</span>, append<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#loop through the grid</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Etaugrid</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">#fit model with ith combo of E and tau</span></span>
<span>  <span class="va">demo</span><span class="op">=</span><span class="fu"><a href="../reference/fitGP.html">fitGP</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">squidlags</span>, </span>
<span>             y<span class="op">=</span><span class="st">"squidgr"</span>,</span>
<span>             x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"squidlog_"</span>,<span class="va">Etaugrid</span><span class="op">$</span><span class="va">tau</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">E</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, </span>
<span>             time<span class="op">=</span><span class="st">"YEAR"</span>, </span>
<span>             predictmethod <span class="op">=</span> <span class="st">"loo"</span><span class="op">)</span></span>
<span>  <span class="co">#store out of sample R2</span></span>
<span>  <span class="va">Etaugrid</span><span class="op">$</span><span class="va">R2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">=</span><span class="va">demo</span><span class="op">$</span><span class="va">outsampfitstats</span><span class="op">[</span><span class="st">"R2"</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">Etaugrid</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">E</span>, y<span class="op">=</span><span class="va">tau</span>, fill<span class="op">=</span><span class="va">R2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">taumax</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">Emax</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"gray"</span><span class="op">)</span>, </span>
<span>        panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"black"</span>, fill<span class="op">=</span><span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="choosingE_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">R2round</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">R2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#if not aleady in order</span></span>
<span><span class="co">#Etaugrid=Etaugrid[order(Etaugrid$tau,Etaugrid$E),] </span></span>
<span><span class="op">(</span><span class="va">bestE</span><span class="op">=</span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">E</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">R2round</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="op">(</span><span class="va">besttau</span><span class="op">=</span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">tau</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">Etaugrid</span><span class="op">$</span><span class="va">R2round</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="va">demo</span><span class="op">=</span><span class="fu"><a href="../reference/fitGP.html">fitGP</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">squidlags</span>, y<span class="op">=</span><span class="st">"squidgr"</span>, </span>
<span>           x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"squidlog_"</span>,<span class="va">besttau</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">bestE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           time<span class="op">=</span><span class="st">"YEAR"</span>, </span>
<span>           predictmethod <span class="op">=</span> <span class="st">"loo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">demo</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of predictors: 6 </span></span>
<span><span class="co">#&gt; Length scale parameters:</span></span>
<span><span class="co">#&gt;       predictor posteriormode</span></span>
<span><span class="co">#&gt; phi1 squidlog_1       0.04734</span></span>
<span><span class="co">#&gt; phi2 squidlog_2       0.24373</span></span>
<span><span class="co">#&gt; phi3 squidlog_3       0.06569</span></span>
<span><span class="co">#&gt; phi4 squidlog_4       0.00746</span></span>
<span><span class="co">#&gt; phi5 squidlog_5       0.02067</span></span>
<span><span class="co">#&gt; phi6 squidlog_6       0.00130</span></span>
<span><span class="co">#&gt; Process variance (ve): 0.203274</span></span>
<span><span class="co">#&gt; Pointwise prior variance (sigma2): 2.647853</span></span>
<span><span class="co">#&gt; Number of populations: 1</span></span>
<span><span class="co">#&gt; In-sample R-squared: 0.8892768 </span></span>
<span><span class="co">#&gt; Out-of-sample R-squared: 0.5833364</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">demo</span><span class="op">)</span></span>
<span><span class="co">#&gt; Plotting out of sample results.</span></span></code></pre></div>
<p><img src="choosingE_files/figure-html/unnamed-chunk-3-3.png" width="700"></p>
<p>This grid search method of selecting models, while thorough, can be
very time consuming. There are some potentially more efficient ways to
arrive at the same answer, described below.</p>
</div>
</div>
<div class="section level2">
<h2 id="increase-e-method">2. Increase E method<a class="anchor" aria-label="anchor" href="#increase-e-method"></a>
</h2>
<p>Increase
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
until performance no longer increases substantially (fixing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
to 1 or some other reasonable minimum value). ARD will drop lags that
are uninformative, allowing for a larger ‘realized’
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>,
as well as unequal lag spacing. You might notice that the set of
relevant lags changes as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
increases (e.g. lag 2 is important when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">E=2</annotation></semantics></math>,
but not when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">E=4</annotation></semantics></math>).
This behavior is normal and occurs because lags sometimes provide
redundant information, and thus the model will identify different lags
as relevant depending on the set available.</p>
<p>Once you identify the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
with the best performance, should you go back and drop lags that were
deemed uninformative (had inverse length scales of 0)? You could do this
if you want, though it’s not strictly necessary. Either way, the result
is a model with a smaller ‘realized’
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
and some mixture of lag spacing. The model performance will probably not
change; however, beware that lags with small but non-zero inverse length
scales can sometimes be influential, and performance might decline if
they are excluded. Iterative forecasting is also a bit trickier when the
lag spacing is uneven, so it might be worthwhile to keep them in if the
plan is to make forecasts.</p>
<div class="section level4">
<h4 id="hastings-powell-model-1">Hastings Powell model<a class="anchor" aria-label="anchor" href="#hastings-powell-model-1"></a>
</h4>
<p>Here, we can clearly see that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">E=2</annotation></semantics></math>
is sufficient.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Emax</span><span class="op">=</span><span class="fl">8</span></span>
<span><span class="va">R2vals</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">Emax</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">Emax</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">demo</span><span class="op">=</span><span class="fu"><a href="../reference/fitGP.html">fitGP</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">HP_train</span>, y<span class="op">=</span><span class="st">"X"</span>,</span>
<span>             x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"X_"</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">i</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             time<span class="op">=</span><span class="st">"Time"</span>, newdata <span class="op">=</span> <span class="va">HP_test</span><span class="op">)</span></span>
<span>  <span class="va">R2vals</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">=</span><span class="va">demo</span><span class="op">$</span><span class="va">outsampfitstats</span><span class="op">[</span><span class="st">"R2"</span><span class="op">]</span></span>
<span>  <span class="co">#print(i)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">demo</span><span class="op">$</span><span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">i</span><span class="op">]</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;     phi1 </span></span>
<span><span class="co">#&gt; 0.020154 </span></span>
<span><span class="co">#&gt;     phi1     phi2 </span></span>
<span><span class="co">#&gt; 0.217163 0.331399 </span></span>
<span><span class="co">#&gt;     phi1     phi2     phi3 </span></span>
<span><span class="co">#&gt; 0.063912 0.056489 0.011711 </span></span>
<span><span class="co">#&gt;     phi1     phi2     phi3     phi4 </span></span>
<span><span class="co">#&gt; 0.066353 0.049745 0.000000 0.004594 </span></span>
<span><span class="co">#&gt;     phi1     phi2     phi3     phi4     phi5 </span></span>
<span><span class="co">#&gt; 0.056124 0.000000 0.038560 0.000000 0.008030 </span></span>
<span><span class="co">#&gt;     phi1     phi2     phi3     phi4     phi5     phi6 </span></span>
<span><span class="co">#&gt; 0.055719 0.000000 0.037928 0.000000 0.008687 0.000000 </span></span>
<span><span class="co">#&gt;     phi1     phi2     phi3     phi4     phi5     phi6     phi7 </span></span>
<span><span class="co">#&gt; 0.055749 0.000000 0.038347 0.000000 0.008479 0.000000 0.000000 </span></span>
<span><span class="co">#&gt;     phi1     phi2     phi3     phi4     phi5     phi6     phi7     phi8 </span></span>
<span><span class="co">#&gt; 0.046518 0.000000 0.000471 0.000471 0.033521 0.012773 0.002145 0.000000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">Emax</span>, <span class="va">R2vals</span>, type<span class="op">=</span><span class="st">"o"</span><span class="op">)</span></span></code></pre></div>
<p><img src="choosingE_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="squid-data-1">Squid data<a class="anchor" aria-label="anchor" href="#squid-data-1"></a>
</h4>
<p>As before, you would be justified in selecting either
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">E=4</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">E=6</annotation></semantics></math>
in this case. We can see that the inverse length scale <code>phi</code>
for lag 6 is quite small, so it is not providing much information.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Emax</span><span class="op">=</span><span class="fl">6</span></span>
<span><span class="va">squidlags</span><span class="op">=</span><span class="fu"><a href="../reference/makelags.html">makelags</a></span><span class="op">(</span><span class="va">squid</span>,<span class="st">"squidlog"</span>,E<span class="op">=</span><span class="va">Emax</span>, tau<span class="op">=</span><span class="fl">1</span>, append <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">R2vals</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">Emax</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">Emax</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">demo</span><span class="op">=</span><span class="fu"><a href="../reference/fitGP.html">fitGP</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">squidlags</span>, </span>
<span>             y<span class="op">=</span><span class="st">"squidgr"</span>,</span>
<span>             x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"squidlog_"</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">i</span><span class="op">)</span><span class="op">)</span>, </span>
<span>             time<span class="op">=</span><span class="st">"YEAR"</span>, </span>
<span>             predictmethod <span class="op">=</span> <span class="st">"loo"</span><span class="op">)</span></span>
<span>  <span class="va">R2vals</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">=</span><span class="va">demo</span><span class="op">$</span><span class="va">outsampfitstats</span><span class="op">[</span><span class="st">"R2"</span><span class="op">]</span></span>
<span>  <span class="co">#print(i)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">demo</span><span class="op">$</span><span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">i</span><span class="op">]</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;     phi1 </span></span>
<span><span class="co">#&gt; 0.035776 </span></span>
<span><span class="co">#&gt;     phi1     phi2 </span></span>
<span><span class="co">#&gt; 0.035482 0.000000 </span></span>
<span><span class="co">#&gt;     phi1     phi2     phi3 </span></span>
<span><span class="co">#&gt; 0.046410 0.193942 0.031216 </span></span>
<span><span class="co">#&gt;     phi1     phi2     phi3     phi4 </span></span>
<span><span class="co">#&gt; 0.061337 0.292041 0.044430 0.124112 </span></span>
<span><span class="co">#&gt;     phi1     phi2     phi3     phi4     phi5 </span></span>
<span><span class="co">#&gt; 0.062538 0.307994 0.049649 0.077748 0.000000 </span></span>
<span><span class="co">#&gt;     phi1     phi2     phi3     phi4     phi5     phi6 </span></span>
<span><span class="co">#&gt; 0.047337 0.243734 0.065694 0.007457 0.020671 0.001297</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">Emax</span>, <span class="va">R2vals</span>, type<span class="op">=</span><span class="st">"o"</span><span class="op">)</span></span></code></pre></div>
<p><img src="choosingE_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="max-e-method">3. Max E method<a class="anchor" aria-label="anchor" href="#max-e-method"></a>
</h2>
<p>Set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
to the maximum value (fixing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
to 1 or some other reasonable minimum value), and let ARD eliminate all
lags that are uninformative. Because performance plateaus, performance
of the resulting model will be equivalent to model with the optimal
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>.
Steve has gotten good results from this approach. Pros: You only have to
fit one model. Cons: The model may include more lag predictors than are
strictly necessary, and you may be eliminating more training data points
(product
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>τ</mi></mrow><annotation encoding="application/x-tex">E\tau</annotation></semantics></math>)
than are necessary. You could look at the inverse length scales from the
‘max
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>’
model, and if you see all lags above some
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>E</mi><mo>*</mo></msup><annotation encoding="application/x-tex">E^*</annotation></semantics></math>
have values of 0, then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>E</mi><mo>*</mo></msup><annotation encoding="application/x-tex">E^*</annotation></semantics></math>
is the embedding dimension, and you would be justified in refitting the
model with higher lags removed (performance should not change, because
the higher lags weren’t contributing anything). This doesn’t always
happen though.</p>
<div class="section level4">
<h4 id="hastings-powell-model-2">Hastings Powell model<a class="anchor" aria-label="anchor" href="#hastings-powell-model-2"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Emax</span><span class="op">=</span><span class="fl">8</span></span>
<span><span class="va">demo</span><span class="op">=</span><span class="fu"><a href="../reference/fitGP.html">fitGP</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">HP_train</span>, y<span class="op">=</span><span class="st">"X"</span>, x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"X_"</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">Emax</span><span class="op">)</span><span class="op">)</span>, time<span class="op">=</span><span class="st">"Time"</span>, newdata <span class="op">=</span> <span class="va">HP_test</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">demo</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of predictors: 8 </span></span>
<span><span class="co">#&gt; Length scale parameters:</span></span>
<span><span class="co">#&gt;      predictor posteriormode</span></span>
<span><span class="co">#&gt; phi1       X_1       0.04652</span></span>
<span><span class="co">#&gt; phi2       X_2       0.00000</span></span>
<span><span class="co">#&gt; phi3       X_3       0.00047</span></span>
<span><span class="co">#&gt; phi4       X_4       0.00047</span></span>
<span><span class="co">#&gt; phi5       X_5       0.03352</span></span>
<span><span class="co">#&gt; phi6       X_6       0.01277</span></span>
<span><span class="co">#&gt; phi7       X_7       0.00214</span></span>
<span><span class="co">#&gt; phi8       X_8       0.00000</span></span>
<span><span class="co">#&gt; Process variance (ve): 0.0001000025</span></span>
<span><span class="co">#&gt; Pointwise prior variance (sigma2): 4.087007</span></span>
<span><span class="co">#&gt; Number of populations: 1</span></span>
<span><span class="co">#&gt; In-sample R-squared: 0.9999973 </span></span>
<span><span class="co">#&gt; Out-of-sample R-squared: 0.9998047</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="squid-data-2">Squid data<a class="anchor" aria-label="anchor" href="#squid-data-2"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Emax</span><span class="op">=</span><span class="fl">6</span></span>
<span><span class="va">demo</span><span class="op">=</span><span class="fu"><a href="../reference/fitGP.html">fitGP</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">squidlags</span>, y<span class="op">=</span><span class="st">"squidgr"</span>, x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"squidlog_"</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">Emax</span><span class="op">)</span><span class="op">)</span>, </span>
<span>           time<span class="op">=</span><span class="st">"YEAR"</span>, predictmethod <span class="op">=</span> <span class="st">"loo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">demo</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of predictors: 6 </span></span>
<span><span class="co">#&gt; Length scale parameters:</span></span>
<span><span class="co">#&gt;       predictor posteriormode</span></span>
<span><span class="co">#&gt; phi1 squidlog_1       0.04734</span></span>
<span><span class="co">#&gt; phi2 squidlog_2       0.24373</span></span>
<span><span class="co">#&gt; phi3 squidlog_3       0.06569</span></span>
<span><span class="co">#&gt; phi4 squidlog_4       0.00746</span></span>
<span><span class="co">#&gt; phi5 squidlog_5       0.02067</span></span>
<span><span class="co">#&gt; phi6 squidlog_6       0.00130</span></span>
<span><span class="co">#&gt; Process variance (ve): 0.203274</span></span>
<span><span class="co">#&gt; Pointwise prior variance (sigma2): 2.647853</span></span>
<span><span class="co">#&gt; Number of populations: 1</span></span>
<span><span class="co">#&gt; In-sample R-squared: 0.8892768 </span></span>
<span><span class="co">#&gt; Out-of-sample R-squared: 0.5833364</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="but-is-it-right">But is it ‘right’?<a class="anchor" aria-label="anchor" href="#but-is-it-right"></a>
</h2>
<p>As mentioned at the end of the <a href="https://tanyalrogers.github.io/GPEDM/articles/practical.html">practical
considerations vignette</a> We suggest not worrying too much about
whether you have exactly the right
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>,
or if the inverse length scales vary among models. Many delay embedding
models can have equivalent performance (particularly with multivariate
predictors), and there is often no way to tell which is the ‘right’ one.
Ideally, your results should be robust to minor differences in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>,
and you can conduct a sensitivity analysis if you are concerned. If
you’re wanting to make <em>inference</em> based on the hyperparameters,
including
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
and the inverse length scales, more care should be taken in terms of
model selection. If all you care about is forecasting, it’s not worth
fussing over too much, and the “max E” approach might be sufficient.</p>
<p>There is no formula, so if in doubt, try multiple approaches and see
what you get. Sometimes you have to make a judgement call based on what
seems the most reasonable or parsimonious for your analysis goals.</p>
</div>
<div class="section level2">
<h2 id="best-practices-and-common-pitfalls">Best practices and common pitfalls<a class="anchor" aria-label="anchor" href="#best-practices-and-common-pitfalls"></a>
</h2>
<ul>
<li><p>Always plot your time series (training and test) before fitting a
model.</p></li>
<li><p>Do not forget the <code>pop</code> argument when generating lags
for multi-population data, otherwise there will be crossover between
time series.</p></li>
<li><p>Poor or strange results can be obtained if the test dataset is
too short, has insufficient variance, or is very inconsistent among
candidate models. Inconsistency usually arises due to the first
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>τ</mi></mrow><annotation encoding="application/x-tex">E\tau</annotation></semantics></math>
timepoints being removed as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
change, which for short test time series, can result in substantial
changes to the baseline variance of the values being predicted across
candidate models.</p></li>
<li><p>When you have multiple populations, you have to consider the time
series length within populations, as well as the number of delay vectors
across all populations, when thinking about how much training/test data
you have for a given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
value.</p></li>
<li><p>You may find that performance results differ depending on the
train/test split used. Consider using <code>loo</code>,
<code>lto</code>, or <code>sequential</code> sampling in these cases
instead of a split, particularly for short time series, or another form
of n-fold cross validation.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Cheng B, Tong H (1992) On consistent nonparametric order
determination and chaos. J. R. Stat. Soc. Ser. B 54, 427–449</p>
<p>Rogers TL, Johnson BJ, Munch SB (2022) Chaos is not rare in natural
ecosystems. Nature Ecology and Evolution 6:1105–1111</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Stephan Munch, Tanya Rogers.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
